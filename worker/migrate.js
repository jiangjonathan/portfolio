/**
 * Simple migration script to convert old KV format to new format
 * Run with: node migrate.js
 */

const OLD_ENTRIES_RAW = `[{"id":"ff8762b1-1ae6-4aff-9d7c-e2f74a3689a9","youtubeId":"n5h0qHwNrHk","artistName":"Radiohead","songName":"Fake Plastic Trees","imageUrl":"blob:http://localhost:5173/31367083-e279-440c-ad82-b48f04d824a7","note":"","releaseYear":"1995","releaseId":"3e8e8360-aaa6-464e-831f-2cb0e1fdcf87","addedAt":"2025-11-13T09:13:13.820Z"},{"id":"e63c4c67-6c3c-4d63-99be-d790fe6c45ed","youtubeId":"jdU16tnrt14","artistName":"Oklou","songName":"take me by the hand ft. Bladee","imageUrl":"blob:http://localhost:5173/33ee2567-a8e2-44f0-9d6e-e7009bbb5680","note":"","releaseYear":"2025","releaseId":"88b77edb-c338-492d-b8ef-aba731fb5f2b","addedAt":"2025-11-13T09:14:41.486Z"},{"id":"3f8bdae7-a544-48b5-8112-52fea936d822","youtubeId":"2KkMyDSrBVI","artistName":"bladee","songName":"Obedient","imageUrl":"blob:http://localhost:5173/9d69fca6-3975-46a1-ae5d-d063a1f4ab49","note":"","releaseYear":"2018","releaseId":"725f97cb-5e7a-4bbb-be43-c6500407a940","addedAt":"2025-11-13T09:30:14.939Z"},{"id":"c58b82c2-e8b5-4708-b8e0-9e3b476d97e0","youtubeId":"vrQWhFysPKY","artistName":"Yung Lean","songName":"Ginseng Strip 2002","imageUrl":"blob:http://localhost:5173/0fc142fb-ab00-4c79-89b6-1b6970e349c0","note":"","releaseYear":"2013","releaseId":"7c63b445-af16-44b0-aa19-9b87c5ff9fae","addedAt":"2025-11-13T09:30:58.391Z"},{"id":"8866c73d-f3fd-4739-8c82-4e5981287f7a","youtubeId":"yHr3XlLBf7M","artistName":"jackzebra","songName":"认真你就输了","imageUrl":"blob:http://localhost:5173/72a24e52-d843-4938-b1cc-1f826de80b47","note":"","releaseYear":"2024","releaseId":"4c9abba7-d9d6-40d2-8b9d-577ed9ea905f","addedAt":"2025-11-13T09:31:25.654Z"},{"id":"f5709697-002e-4390-a4f4-16d358d13717","youtubeId":"gQehpVrU4-o","artistName":"Mechatok","songName":"Expression On Your Face","imageUrl":"blob:http://localhost:5173/fbd189be-1cc0-4766-bd8b-c77f9813cb7b","note":"","releaseYear":"2025","releaseId":"2e80b324-f399-4d2c-89e5-02b27c528f8f","addedAt":"2025-11-13T09:32:21.826Z"},{"id":"a47b9b9a-5144-4fe6-a779-d8ab3372da0b","youtubeId":"pcEJyvv6_kc","artistName":"Radiohead","songName":"Weird Fishes/Arpeggi","imageUrl":"blob:http://localhost:5173/df835b76-1d4d-4522-a1c7-a2617af0b444","note":"one of the best songs from one of the best live recordings of all time.","releaseYear":"2008","releaseId":"023abf42-e340-4a45-84d1-1fc95eaa46e9","addedAt":"2025-11-13T09:34:20.705Z"},{"id":"37b41ca3-7a93-48e9-9580-d48ce7a39b1a","youtubeId":"jaxqd77d3oE","artistName":"Depeche Mode","songName":"Enjoy The Silence","imageUrl":"blob:http://localhost:5173/cf254fb8-dc37-461f-b456-0dd376d6029c","note":"dave gahan and martin gore have so much swag","releaseYear":"1990","releaseId":"67cf905e-8e7c-4f29-8c17-753e3589328d","addedAt":"2025-11-13T09:37:25.332Z"},{"id":"591a151a-8159-4cf4-a09c-82f8ffa73a51","youtubeId":"DPC9erC5WqU","artistName":"Keith Ape","songName":"잊지마","imageUrl":"blob:http://localhost:5173/f89bc6db-95a0-4da6-9fc8-bda58031825b","note":"orca ninjas go rambo","releaseYear":"2015","releaseId":"7425dc1f-d4bd-4bfa-af65-5c7eb6382484","addedAt":"2025-11-13T09:38:50.778Z"},{"id":"7f3c0a1d-bcdb-4d5e-9ae1-1683d1ac6563","youtubeId":"YG3EhWlBaoI","artistName":"Playboi Carti","songName":"2024","imageUrl":"blob:http://localhost:5173/8ae9da05-aa7e-43f2-a038-7d32d46b71af","note":"","releaseId":"05a8da3d-4b2f-4084-978c-e78bd34b98f1","addedAt":"2025-11-13T09:39:51.480Z"},{"id":"3eff90b5-84aa-4ed1-b970-9c2dbda61849","youtubeId":"KB5TKob9PeA","artistName":"fakemink","songName":"Easter Pink","imageUrl":"blob:http://localhost:5173/75dd6a18-6f80-406c-97e3-4c9d34cb48c4","note":"ethereal beat","releaseYear":"2025","releaseId":"16c3780b-2454-4056-b66c-64eeb60dc74c","addedAt":"2025-11-13T09:40:51.193Z"},{"id":"2088d3c2-1182-4bb2-b7c3-5015c7f30dd7","youtubeId":"hN2jOHeI5tc","artistName":"王菲","songName":"夢中人","imageUrl":"blob:http://localhost:5173/211cf5bd-245d-4709-ad09-1d00f66b6f12","note":"dreamy song :P","releaseYear":"2019","releaseId":"abd7abf4-057e-4118-9311-1d97197b2f0a","addedAt":"2025-11-13T09:45:48.915Z"},{"id":"d77fbb8b-2fbd-4e19-b9f3-1241dc69f049","youtubeId":"Xyv4Bjja8yc","artistName":"Drake","songName":"Find Your Love","imageUrl":"blob:http://localhost:5173/de7748a9-0e25-46dc-b166-62092101606c","note":"","releaseId":"1d335af3-4908-498d-bca9-232face58be7","addedAt":"2025-11-13T09:48:41.873Z"},{"id":"e967b13d-e01f-4b31-aa24-7b32535c51bc","youtubeId":"Ic5vxw3eijY","artistName":"Estelle ft. Kanye West","songName":"American Boy","imageUrl":"blob:http://localhost:5173/5f338f5a-14d5-437c-9246-ee11e9906443","note":"number one victory royale","releaseYear":"2008","releaseId":"bd75dbdf-e5e1-4f2b-9cdd-00c3656fc65d","addedAt":"2025-11-13T09:50:00.235Z"},{"id":"e92669c8-67ca-4e40-b89f-5a46ff0c04f2","youtubeId":"4m48GqaOz90","artistName":"The Black Eyed Peas","songName":"Boom Boom Pow","imageUrl":"blob:http://localhost:5173/edab933f-ba7f-42cc-ab1d-a3830a79d7a0","note":"boom boom boom","releaseYear":"2009","releaseId":"a53ff218-7aed-4f49-8f0a-8d044205d612","addedAt":"2025-11-13T09:51:45.276Z"},{"id":"067f57cb-f96f-4a5b-b689-787f41b42765","youtubeId":"Phh3oVCtzBg","artistName":"Geese","songName":"Taxes","imageUrl":"blob:http://localhost:5173/cebe2507-acd9-49ea-9727-8f4cc4689608","note":"in this world nothing can be said to be certain, except death and geese.","releaseYear":"2025","releaseId":"3d36e590-3120-4899-9b9e-bc7de6cac51a","addedAt":"2025-11-13T09:58:47.998Z"},{"id":"477c7cfc-aec1-4db0-8cbe-0cb15fe1e24f","youtubeId":"WSeNSzJ2-Jw","artistName":"Skrillex","songName":"Scary Monsters And Nice Sprites","imageUrl":"blob:http://localhost:5173/5d9a2daa-379b-416f-85ab-17579857fbe0","note":"in every youtube download playlist i had as a kid","releaseYear":"2010","releaseId":"e32b67d6-bbd0-42a5-bca9-9bd33e927d74","addedAt":"2025-11-13T10:02:15.359Z"},{"id":"a24eb0b4-eff3-4080-a19d-035a013d4043","youtubeId":"_9L3j-lVLwk","artistName":"Young Thug","songName":"Wyclef Jean","imageUrl":"blob:http://localhost:5173/c56f2df4-f639-4fbb-819d-3640b9b7e0ad","note":"free thug","releaseYear":"2016","releaseId":"23ffea4e-02a5-47d6-af66-be9077f0d483","addedAt":"2025-11-13T10:07:49.676Z"},{"id":"6a888b88-1616-409f-83d3-1bf2fc436130","youtubeId":"yhGCk1Nlyfw","artistName":"Mojave 3","songName":"Love Songs On The Radio","imageUrl":"blob:http://localhost:5173/5f09305d-f41c-4092-bcfa-10e391c09542","note":"saddest country music","releaseYear":"1996","releaseId":"7b920315-ac72-438c-a09e-b543a124e3d2","addedAt":"2025-11-13T10:09:36.292Z"},{"id":"a5a47490-facf-4786-b459-ff2ffdf3f61c","youtubeId":"efiDnHS3fzk","artistName":"Marvin Gaye","songName":"Mercy Mercy Me","imageUrl":"blob:http://localhost:5173/fccff16a-7af7-4a02-82c2-a95448f968b3","note":"fish full of mercury...","releaseYear":"1999","releaseId":"dcde6c03-96b7-4930-89f4-b77bbd449c0b","addedAt":"2025-11-13T10:13:51.472Z"},{"id":"3580ede8-a398-48f4-b94c-efcba3e04926","youtubeId":"jkM3M3zGcGE","artistName":"Slowdive","songName":"Alison","imageUrl":"blob:http://localhost:5173/a82fe5b6-7c44-4291-9e32-327286417588","note":"i miss alison now","genre":"shoegaze","releaseYear":"1993","releaseId":"12694708-e437-4874-a5d4-c1ca0ec46313","addedAt":"2025-11-13T10:26:33.572Z"},{"id":"275f16b2-93c2-4450-8b24-48459e42fe0e","youtubeId":"LhLmgg_u29k","artistName":"New Order","songName":"Bizarre Love Triangle","imageUrl":"blob:http://localhost:5173/a390c424-7a6b-47a9-904e-4a865a6cf5b3","note":"one of the best love songs, and one of my favourite outros.","releaseYear":"1986","releaseId":"de53b49d-be39-4daf-afe2-d650269862d7","addedAt":"2025-11-13T10:30:13.297Z"},{"id":"691ce00c-8a76-4c5c-a9c2-3b0160cbf8ee","youtubeId":"kcPc18SG6uA","artistName":"Sade","songName":"The Sweetest Taboo","imageUrl":"blob:http://localhost:5173/eaa8b527-fe71-4602-9092-fb8f456c7559","note":"don't let it slip away","releaseYear":"1985","releaseId":"66e7b237-4e0f-480f-a82f-b49c45d68e5e","addedAt":"2025-11-13T10:34:13.403Z"},{"id":"66638851-f7e8-4b0c-8f15-4f21a20bfc41","youtubeId":"ZHwVBirqD2s","artistName":"Elton John","songName":"I'm Still Standing","imageUrl":"blob:http://localhost:5173/29594b9e-1003-4958-adf6-1c6f2dac22d7","note":"motivational","releaseYear":"2002","releaseId":"f287ff0e-cc42-3862-989e-b955be47150d","addedAt":"2025-11-13T10:36:10.206Z"},{"id":"1ea3819f-1553-4ecf-a0a4-0e06c8e4db7b","youtubeId":"ICK6e9WK2A8","artistName":"Steely Dan","songName":"Deacon Blues","imageUrl":"blob:http://localhost:5173/e1492799-e891-40a5-9860-674866dd1608","note":"smooth like scotch","releaseYear":"1978","releaseId":"97efa262-b1fb-42b7-953c-712e7a23eaff","addedAt":"2025-11-13T10:39:47.285Z"},{"id":"8c297c7f-abc9-420e-9def-0b65add1dbed","youtubeId":"XUR0l3-3ORk","artistName":"fakemink","songName":"Just Kitten","imageUrl":"blob:http://localhost:5173/14f477bc-e9ab-4d64-ba4e-c9799fbb3621","note":"meow","releaseYear":"2023","releaseId":"59863fba-2751-4db0-9cd4-c5d3290c5fec","addedAt":"2025-11-13T10:42:09.589Z"},{"id":"c505cb97-4193-49df-af2e-9f1150dca08c","youtubeId":"Yu_I44iQsJo","artistName":"Cocteau Twins","songName":"Summerhead","imageUrl":"https://img.youtube.com/vi/Yu_I44iQsJo/maxresdefault.jpg","note":"nasty guitar. cover made by Walter Wick makes it even better","addedAt":"2025-11-13T10:47:12.081Z"},{"id":"8b075077-d5e6-4d13-8a1e-f168ebdcec22","youtubeId":"04mfKJWDSzI","artistName":"Gorillaz","songName":"On Melancholy Hill","imageUrl":"blob:http://localhost:5173/2596b6a8-6e3b-48d2-8d9f-8b548246c002","note":"","releaseYear":"2010","releaseId":"e7def36e-04dc-3a80-83c5-4f705c6eab2f","addedAt":"2025-11-13T10:50:42.354Z"},{"id":"9f33601e-bbdc-42fa-ae6e-62d37bd3fdac","youtubeId":"OPe7tn_Hju4","artistName":"Magdalena Bay","songName":"Imaginal Disk","imageUrl":"https://img.youtube.com/vi/OPe7tn_Hju4/maxresdefault.jpg","note":"full album cuz why not","addedAt":"2025-11-13T10:51:38.088Z"},{"id":"bd5bd0c8-4545-4f3b-b11e-e4c720dd6d40","youtubeId":"qN4sIlaX6Sk","artistName":"Beach House","songName":"Wild","imageUrl":"blob:http://localhost:5173/8e7fc3be-3816-4f67-9dc3-9bbf3cfa5294","note":"life changing album","releaseYear":"2012","releaseId":"ad2d6641-7cdc-4930-9490-51aedab12281","addedAt":"2025-11-13T10:54:23.385Z"},{"id":"93e6be71-faa4-4c88-b157-9405b2ad6f07","youtubeId":"h2Y1oH3EZWc","artistName":"Björk","songName":"Big Time Sensuality","imageUrl":"blob:http://localhost:5173/1d48bf28-a460-4b12-bd83-99cabd0828f4","note":"so joyful and sweet","releaseYear":"2015","releaseId":"e9d58088-004a-40d8-bcc1-7b7869346907","addedAt":"2025-11-13T10:58:33.485Z"},{"id":"61a9ecd4-7657-47ac-84a9-2139b65dc47f","youtubeId":"rP3ovD8ZSS4","artistName":"Sonic Youth","songName":"Incinerate","imageUrl":"blob:http://localhost:5173/f2f63e37-3bce-49be-bc67-7367b0809b26","note":"sonically youthifying","releaseYear":"2016","releaseId":"7843549f-919f-4be5-80cb-624e5b32f8b8","addedAt":"2025-11-13T11:02:02.387Z"},{"id":"69a2d496-2986-4edc-b1e9-3ef1c2442648","youtubeId":"Rs_kavGKeHI","artistName":"Ecco2k","songName":"Peroxide","imageUrl":"blob:http://localhost:5173/3efb3a8a-77fa-4182-b3ad-7ef0b93578c8","note":"song is a bass test","releaseYear":"2019","releaseId":"f02a6c7c-ada5-4383-9c9c-417024693288","addedAt":"2025-11-13T11:03:10.625Z"},{"id":"f1f595a7-ded5-4320-8263-2b757b494cb9","youtubeId":"dDBnn-dghs8","artistName":"Thaiboy Digital","songName":"Haters Broke","imageUrl":"blob:http://localhost:5173/7b2cd790-f2ad-446d-b100-06eb81029684","note":"i don't wish anything on my haters","releaseYear":"2014","releaseId":"0ee012a4-7585-4da4-b400-33037a38d28e","addedAt":"2025-11-13T11:05:38.151Z"},{"id":"86b55734-3b1d-49f0-a821-34cbfd1949a0","youtubeId":"VU_2R1rjbD8","artistName":"Arcade Fire","songName":"Neighborhood #1 (Tunnels)","imageUrl":"blob:http://localhost:5173/fefd8f51-690e-4c73-ac58-3bd0643ac9d1","note":"mind purifying","releaseYear":"2017","releaseId":"ef65690f-70a6-4d0a-913b-3710285279fa","addedAt":"2025-11-13T11:10:56.460Z"},{"id":"ef7f668f-f752-44ee-832a-5b0ad9280896","youtubeId":"6KnYw4EwYGc","artistName":"Cocteau Twins","songName":"Heaven Or Las Vegas","imageUrl":"https://coverartarchive.org/release/ebbbc745-596d-3ec6-8dc5-03f7a46e624d/front-500","note":"","releaseYear":"1990","releaseId":"ebbbc745-596d-3ec6-8dc5-03f7a46e624d","addedAt":"2025-11-13T18:01:44.223Z"},{"id":"da6dc3ab-7bcb-4e6a-a32f-267d8e33507f","youtubeId":"EL-D9LrFJd4","artistName":"Cowboy Bebop","songName":"Opening | Tank!","imageUrl":"https://img.youtube.com/vi/EL-D9LrFJd4/maxresdefault.jpg","note":"","addedAt":"2025-11-13T18:29:25.347Z"},{"id":"27462c1a-3021-43d5-bcd0-66fd58841bca","youtubeId":"yL8e_uUGsz4","artistName":"King Krule","songName":"Out Getting Ribs","imageUrl":"blob:http://localhost:5173/87ab7ad1-b379-4e77-96b4-e17587bcfdcf","note":"tuffest ginger","releaseYear":"2013","releaseId":"d1c4a59b-03b6-4c53-985c-1369d845b1a0","addedAt":"2025-11-13T18:54:54.290Z"},{"id":"3c9693a0-693c-4842-bb97-4b9bc58fc6f3","youtubeId":"SuCYsNERsgA","artistName":"2hollis","songName":"jeans","imageUrl":"blob:http://localhost:5173/5df91e96-aeb7-4453-952b-35708f4b5d22","note":"","releaseId":"4df67b29-4168-4770-94e5-f94db2f48084","addedAt":"2025-11-13T19:04:22.139Z"},{"id":"a0bd741e-9e58-41a0-8c12-57839653a89c","youtubeId":"Fy7WIdkxwDw","artistName":"OsamaSon","songName":"The Whole World Is Free","imageUrl":"blob:http://localhost:5173/b09b86ef-75e6-4401-ac05-46a9756a8d8e","note":"OK truely the hardest istg","releaseYear":"2025","releaseId":"d19f959f-9f02-4bf7-92a9-66f8c9374ba1","addedAt":"2025-11-13T19:05:30.210Z"},{"id":"0ac5b357-5dcb-41ae-a5be-f14e01970ad2","youtubeId":"N-TKOh0zsvU","artistName":"Stan Getz","songName":"The Girl From Ipanema","imageUrl":"blob:http://localhost:5173/697d44b1-efb9-4ab2-8a68-5c7960748a6e","note":"bossa nova at it's best","releaseYear":"2014","releaseId":"bacb03db-9dd7-441f-be1b-e940ddec0623","addedAt":"2025-11-13T19:13:50.829Z"},{"id":"4e00a1f2-4d7d-4da0-9a0a-a2a6161643bc","youtubeId":"KvknOXGPzCQ","artistName":"Deftones","songName":"Be Quiet And Drive (Far Away)","imageUrl":"blob:http://localhost:5173/eebe65cf-97b2-4daa-96d9-e0e32925b234","note":"i don't care where, just far","releaseYear":"2011","releaseId":"26ea1bfe-1b66-453b-9e55-81aa8f8c4054","addedAt":"2025-11-13T19:26:58.437Z"},{"id":"03bea00d-417c-4658-ac72-0b3432fd4b5b","youtubeId":"v3kN22SZFtA","artistName":"kegøn","songName":"TESLA feat. Billionhappy & Effie","imageUrl":"blob:http://localhost:5173/c2bfbe04-ecfb-4f7f-b98d-330d2f4070e3","note":"the avengers of the east asian underground","releaseYear":"2025","releaseId":"637ef397-232c-413e-8b69-031fad589ff6","addedAt":"2025-11-13T19:29:56.952Z"},{"id":"a7b275f2-3aa6-492c-97f2-3d819e447636","youtubeId":"ALQ8fqKl0ec","artistName":"Billionhappy","songName":"中国人在欧洲","imageUrl":"https://img.youtube.com/vi/ALQ8fqKl0ec/maxresdefault.jpg","note":"there's kanye and jay-z in paris, and there's billionhappy in europe","addedAt":"2025-11-13T19:32:55.519Z"},{"id":"51522273-02c7-4d38-abcc-a7c253a4f5b9","youtubeId":"tkPoOvVnbRk","artistName":"Playboi Carti","songName":"Long Time","imageUrl":"blob:http://localhost:5173/728b283f-d357-4dad-b6f1-ee842e8963ba","note":"pursuing cap and gown i go to class","releaseId":"8b72aa31-3033-4861-8f99-ed6debf30a1e","addedAt":"2025-11-13T19:37:36.256Z"},{"id":"a8ff7b05-2239-416f-bde7-7196d8b970d3","youtubeId":"u5CVsCnxyXg","artistName":"Radiohead","songName":"No Surprises","imageUrl":"blob:http://localhost:5173/4a53074d-988a-4bd4-b265-375cf81377df","note":"can you hold your breath as long as thom yorke?","releaseYear":"1997","releaseId":"541a0976-ca45-3c0f-89e5-26bc376f58d1","addedAt":"2025-11-13T19:39:23.992Z"},{"id":"e7bd20db-e8a4-4700-8944-c2a3f70694b5","youtubeId":"4aeETEoNfOg","artistName":"The Smashing Pumpkins","songName":"1979","imageUrl":"blob:http://localhost:5173/93b99ec5-17c3-40f9-a36e-a914960e26a9","note":"mellon collic nostalgia","genre":"alternative rock","releaseYear":"1996","releaseId":"bc3a5888-39b4-39d4-a10e-cc1b5309ba6a","addedAt":"2025-11-13T19:51:55.462Z"}]`;

async function migrate() {
  const entries = JSON.parse(OLD_ENTRIES_RAW);

  console.log(`Migrating ${entries.length} entries...`);

  // Use wrangler CLI to add each entry
  const { execSync } = require('child_process');

  for (const entry of entries) {
    const key = `entry:${entry.id}`;
    const value = JSON.stringify(entry);

    try {
      execSync(
        `npx wrangler kv key put "${key}" '${value.replace(/'/g, "'\\''")}' --binding=LIBRARY`,
        { cwd: __dirname, stdio: 'inherit' }
      );
      console.log(`✓ Migrated: ${entry.artistName} - ${entry.songName}`);
    } catch (error) {
      console.error(`✗ Failed to migrate ${key}:`, error.message);
    }
  }

  console.log('\n✓ Migration complete!');
  console.log('\nTo verify, run: curl http://localhost:49341/api/library');
}

migrate().catch(console.error);
